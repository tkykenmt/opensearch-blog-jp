---
title: "[ç¿»è¨³] OpenSearch ã®æ–°ã—ã„ PPL æ©Ÿèƒ½ã§ã‚ˆã‚Šè‰¯ã„å¯è¦³æ¸¬æ€§ã¨ã‚ˆã‚Šæ·±ã„æ´å¯Ÿã‚’"
emoji: "ğŸ“Š"
type: "tech"
topics: ["opensearch"]
published: false
publication_name: opensearch
published_at: 2025-11-25
---

:::message
ã“ã®è¨˜äº‹ã¯ [OpenSearch Project ã®å…¬å¼ãƒ–ãƒ­ã‚°è¨˜äº‹](https://opensearch.org/blog/better-observability-deeper-insights-opensearchs-new-piped-processing-language-capabilities/) ã®æ—¥æœ¬èªç¿»è¨³ã§ã™ã€‚
:::

https://opensearch.org/blog/better-observability-deeper-insights-opensearchs-new-piped-processing-language-capabilities/

[OpenSearch 3.3](https://opensearch.org/blog/explore-opensearch-3-3/) ã‹ã‚‰ã€Piped Processing Language (PPL) ã«ã¯ã€ãƒ­ã‚°åˆ†æã¨å¯è¦³æ¸¬æ€§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç°¡ç´ åŒ–ã™ã‚‹æ–°ã—ã„æ©Ÿèƒ½ã¨æ”¹å–„ã•ã‚ŒãŸæ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ›´æ–°ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç›£è¦–ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®åˆ†æãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã¯ã€ä¸€èˆ¬çš„ãªãƒ­ã‚°åˆ†æã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿç”¨çš„ãªä¾‹ã‚’é€šã˜ã¦ã€æ–°ã—ã„ PPL ã‚³ãƒãƒ³ãƒ‰ã¨é–¢æ•°ã‚’æ¢ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ©Ÿèƒ½å¼·åŒ–ãŒã€è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®çµåˆã€éæ§‹é€ åŒ–ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã€æ™‚ç³»åˆ—åˆ†æã®å®Ÿè¡Œã«ã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã‚’å­¦ã³ã¾ã™ã€‚ã¾ãŸã€ã‚¯ã‚¨ãƒªã‚¨ãƒ³ã‚¸ãƒ³ã¨ã—ã¦ã® Apache Calcite ã®çµ±åˆã‚’å«ã‚€ã€3.3 ãƒªãƒªãƒ¼ã‚¹ã§ã®å¤§å¹…ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã«ã¤ã„ã¦ã‚‚å¼·èª¿ã—ã¾ã™ã€‚

## æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã¨é–¢æ•°

OpenSearch 3.3 ã¯ã€**9 ã¤ã®æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰**ã¨ **15 ã®æ–°ã—ã„é–¢æ•°**ã§ PPL æ©Ÿèƒ½ã‚’å¤§å¹…ã«æ‹¡å¼µã—ã¾ã™ã€‚ã•ã‚‰ã«ã€æ—¢å­˜ã®ã‚³ãƒãƒ³ãƒ‰ã®æ§‹æ–‡ã‚’æ´—ç·´ã—ã€ä½¿ã„ã‚„ã™ãã—ã€ã•ã¾ã–ã¾ãªåˆ†æã‚·ãƒŠãƒªã‚ªã§ã‚ˆã‚Šç›´æ„Ÿçš„ãªã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚·ãƒŠãƒªã‚ªã¯ã€æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã¨é–¢æ•°ãŒãƒ‡ãƒ¼ã‚¿ã®åˆ†æã«ã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã‚’å¼·èª¿ã—ã¦ã„ã¾ã™ã€‚

### å˜ä¸€ã‚¯ã‚¨ãƒªå†…ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®çµåˆ

ã“ã®ãƒªãƒªãƒ¼ã‚¹ã¯ã€ã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‡ãƒ¼ã‚¿ã®çµåˆã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ“ä½œã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã§ PPL ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚’å¼·åŒ–ã—ã¾ã™ã€‚`append` ã‚³ãƒãƒ³ãƒ‰ã¯ã€è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã®çµæœã‚’å˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ãƒãƒ¼ã‚¸ã—ã€ç•°ãªã‚‹ã‚½ãƒ¼ã‚¹ã‚„æ™‚é–“ç¯„å›²ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç°¡å˜ã«çµåˆã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚`join` ã‚³ãƒãƒ³ãƒ‰ã¯ 2 ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’çµåˆã—ã¾ã™ã€‚å·¦å´ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¾ãŸã¯ãƒ‘ã‚¤ãƒ—ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›ã«ã§ãã€å³å´ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¾ãŸã¯ `subsearch` ã®ã„ãšã‚Œã‹ã«ã§ãã¾ã™ã€‚

æ¬¡ã®ä¾‹ã§ã¯ã€`join` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ Web ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã¨åœ°ç†çš„ IP ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã—ã€æœ€ã‚‚å¤šãã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹å›½ã‚’ç‰¹å®šã§ãã¾ã™ã€‚

```
PPL> source = web_logs
  | join type=inner client_ip [source=ip_geodata]
  | stats count() as total_requests by country
```

CLI ã¯æ¬¡ã®çµæœã‚’è¿”ã—ã¾ã™ã€‚

```
â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ country  â”ƒtotal_requestsâ”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ USA      â”‚ 5            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Canada   â”‚ 3            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UK       â”‚ 1            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ™‚ç³»åˆ—åˆ†æ

PPL ã¯ã€æ–°ã—ã„ `timechart`ã€`bin`ã€`eventstats` ã‚³ãƒãƒ³ãƒ‰ã§ã€åˆç†åŒ–ã•ã‚ŒãŸæ™‚é–“çš„ãŠã‚ˆã³åˆ†å¸ƒåˆ†æã‚’è¿½åŠ ã—ã¾ã™ã€‚`timechart` ã‚³ãƒãƒ³ãƒ‰ã¯ã€æŸ”è»Ÿãªã‚¹ãƒ‘ãƒ³åˆ¶å¾¡ã§æ™‚é–“é–“éš”ã«ã‚ãŸã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„ã—ã€æ™‚ç³»åˆ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚®ãƒ£ãƒƒãƒ—åŸ‹ã‚ã¨çµæœã®é †åºä»˜ã‘ã‚’è‡ªå‹•çš„ã«å‡¦ç†ã—ã¾ã™ã€‚æ™‚é–“ã‚’ä¸»è»¸ã¨ã—ã¦çµæœã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã€è¿½åŠ ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚ˆã‚‹ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚`bin` ã‚³ãƒãƒ³ãƒ‰ã¯ã€æ•°å€¤ã‚’ç¯„å›²ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã€åˆ†å¸ƒã‚’åˆ†æã—ã€ãƒ‡ãƒ¼ã‚¿ã®åºƒãŒã‚Šã¨é »åº¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç†è§£ã—ã‚„ã™ãã—ã¾ã™ã€‚`eventstats` ã‚³ãƒãƒ³ãƒ‰ã¯ã€å…ƒã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’*ä¿æŒ*ã—ãªãŒã‚‰ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è¦ç´„çµ±è¨ˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã€PPL ã‚¯ã‚¨ãƒªå†…ã§ç›´æ¥æ™‚é–“çš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒã‚’åˆ†æã—ã‚„ã™ããªã‚Šã€è¿½åŠ ã®å‡¦ç†ãªã—ã§ãƒˆãƒ¬ãƒ³ãƒ‰ã¨å¤–ã‚Œå€¤ã‚’ç‰¹å®šã§ãã¾ã™ã€‚`earliest` ã¨ `latest` é–¢æ•°ã¯ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®å€¤ã‚’å–å¾—ã—ã€æ™‚ç³»åˆ—åˆ†æã®ãŸã‚ã«ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®å€¤ã®æœ€åˆã¾ãŸã¯æœ€æ–°ã®å‡ºç¾ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã®ä¾‹ã§ã¯ã€`timechart` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ 1 æ™‚é–“é–“éš”ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã€ã“ã‚Œã‚‰ã®é–“éš”å†…ã®å„é‡å¤§åº¦ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚°æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

```
PPL> source=demo-logs-otel-v1-*
    | timechart span=1h count() by severityText
```

OpenSearch Dashboards ã§ã“ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ç”»åƒã«ç¤ºã™ã‚ˆã†ã«ã€è¦–è¦šåŒ–ã¯é‡å¤§åº¦ãƒ¬ãƒ™ãƒ«åˆ¥ã®æ™‚é–“çµŒéã«ä¼´ã†ãƒ­ã‚°åˆ†å¸ƒã‚’ç¤ºã—ã¾ã™ã€‚

![timechart ã®è¦–è¦šåŒ–](/images/opensearch-ppl-new-capabilities/timechart-scaled.png)

### ã‚¯ã‚¨ãƒªæ™‚ã®éæ§‹é€ åŒ–ãƒ­ã‚°å‡¦ç†

PPL ã¯ã€`regex`ã€`rex`ã€`spath` ã‚³ãƒãƒ³ãƒ‰ã§ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å‰å‡¦ç†ãªã—ã§ã€ã‚¯ã‚¨ãƒªå†…ã§ç›´æ¥éæ§‹é€ åŒ–ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€æŠ½å‡ºã€è§£æã§ãã¾ã™ã€‚`regex` ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã€`rex` ã¯æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã—ã¦ç”Ÿã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡ºã—ã€`spath` ã¯ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨é…åˆ—ã‚’å«ã‚€ JSON ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡ºã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€å†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãªã—ã§æ–°ã—ã„ãƒ­ã‚°å½¢å¼ã‚’ã™ãã«æ“ä½œã§ãã€ä»¥å‰ã¯éæ§‹é€ åŒ–ã ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã™ãã«åˆ†æã§ãã¾ã™ã€‚

æ¬¡ã®ä¾‹ã§ã¯ã€`rex` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ± (`loglevel`ã€`action`ã€`userid`ã€`sourceip`) ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

```
PPL> source=app_logs
    | rex field=message '\[(?<loglevel>\w+)\] (?<action>.*) for userId=(?<userid>\d+).*IP=(?<sourceip>[\d\.]+)'
    | head 5
    | fields loglevel, action, userid, sourceip
```

CLI ã¯æ¬¡ã®çµæœã‚’è¿”ã—ã¾ã™ã€‚

```
â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ loglevelâ”ƒ action                    â”ƒ userid â”ƒ sourceip      â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ ERROR   â”‚User authentication failed â”‚ 12345  â”‚ 192.168.1.100 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ERROR   â”‚User authentication failed â”‚ 12346  â”‚ 192.168.1.101 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INFO    â”‚ Successful login          â”‚ 12347  â”‚ 192.168.1.102 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ERROR   â”‚User authentication failed â”‚ 12345  â”‚ 192.168.1.100 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INFO    â”‚ Password reset requested  â”‚ 12346  â”‚ 192.168.1.101 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿å‹ã®ã‚µãƒãƒ¼ãƒˆ

ã“ã‚Œã‚‰ã®æœ€æ–°ã®æ›´æ–°ã«ã‚ˆã‚Šã€*ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ™‚*ã§ã¯ãªã*æ¤œç´¢æ™‚*ã«è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿å¤‰æ›ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚æ—¢å­˜ã® PPL é–¢æ•°ã¯ã€æ–‡å­—åˆ—ã€æ•°å€¤ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãªã©ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿å‹ã‚’å‡¦ç†ã—ã¾ã™ã€‚ã‚µãƒãƒ¼ãƒˆã¯ã€`list` ã‚„ `values` ãªã©ã®è¤‡æ•°å€¤é›†ç´„é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿å‹ã«æ‹¡å¼µã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®é–¢æ•°ã¯ã€é›†ç´„ä¸­ã«è¤‡æ•°ã®å€¤ã‚’æ§‹é€ åŒ–ã•ã‚ŒãŸé…åˆ—ã«åé›†ã—ã€`list` ã¯é‡è¤‡ã‚’ä¿æŒã—ã€`values` ã¯ä¸€æ„ã®å€¤ã®ã¿ã‚’è¿”ã—ã¾ã™ã€‚`mvjoin` é–¢æ•°ã¯ã€æŒ‡å®šã•ã‚ŒãŸåŒºåˆ‡ã‚Šæ–‡å­—ã‚’ä½¿ç”¨ã—ã¦è¤‡æ•°å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å˜ä¸€ã®æ–‡å­—åˆ—ã«çµåˆã—ã€ã‚¯ã‚¨ãƒªå†…ã§ç›´æ¥é…åˆ—ã‚’æ“ä½œã—ã‚„ã™ãã—ã¾ã™ã€‚

æ¬¡ã®ä¾‹ã§ã¯ã€`values` é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã€ãƒšãƒ¼ã‚¸é–“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ã‚’åˆ†æã—ã€ä¸€èˆ¬çš„ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®šã—ã¾ã™ã€‚

```
PPL> source=user_activity
    | stats
        values(page_url) as navigation_path,
        max(duration) as max_duration,
        avg(duration) as avg_duration
        by session_id
    | eval path_length = array_length(navigation_path)
    | where path_length > 3
    | sort max_duration desc
```

CLI ã¯æ¬¡ã®çµæœã‚’è¿”ã—ã¾ã™ã€‚

```
â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒsession_idâ”ƒ navigation_path                                           â”ƒmax_durationâ”ƒavg_durationâ”ƒpath_lengthâ”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚sess_005  â”‚ ["/home","/products","/product/789","/cart","/checkout"]  â”‚ 300        â”‚ 186        â”‚ 5         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚sess_002  â”‚ ["/home","/search","/product/123","/cart"]                â”‚ 300        â”‚ 142.5      â”‚ 4         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚sess_001  â”‚ ["/home","/products","/product/456","/cart","/checkout"]  â”‚ 240        â”‚ 156        â”‚ 5         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚sess_003  â”‚ ["/home","/blog","/blog/post-1","/blog/post-2","/contact"]â”‚ 240        â”‚ 129        â”‚ 5         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å¼·åŒ–

æ­´å²çš„ã«ã€OpenSearch PPL ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¯ã‚¨ãƒªã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 3.0 ã§ã¯ã€[Apache Calcite](https://opensearch.org/blog/enhanced-log-analysis-with-opensearch-ppl-introducing-lookup-join-and-subsearch/) ã«åŸºã¥ãå®Ÿé¨“çš„ãªã‚¯ã‚¨ãƒªã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãƒ¼ã‚’å°å…¥ã—ã¾ã—ãŸã€‚OpenSearch 3.3 ä»¥é™ã€Apache Calcite ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãƒ¼ã¨ãªã‚Šã€ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã¨ã‚³ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®ä¸¡æ–¹ã®æœ€é©åŒ–ã‚’å«ã‚€é«˜åº¦ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

PPL ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è©•ä¾¡ã™ã‚‹ãŸã‚ã«ã€PPL Big5 ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ã‚ˆã‚Šã€ã•ã¾ã–ã¾ãªåˆ†æã‚·ãƒŠãƒªã‚ªã¨ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ãŸã‚‹æ¨™æº–åŒ–ã•ã‚ŒãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚è‡ªå‹•åŒ–ã•ã‚ŒãŸå¤œé–“ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã«ã‚ˆã‚Šã€ä¸€è²«ã—ãŸå“è³ªãŒä¿è¨¼ã•ã‚Œã€ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ã®æ¤œå‡ºã«å½¹ç«‹ã¡ã¾ã™ã€‚ä¸€æ–¹ã€å…¬é–‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¯è¦–åŒ–ã§ãã¾ã™ã€‚å¤œé–“ã® Big5 PPL ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯ã€[OpenSearch Performance Benchmarks ãƒšãƒ¼ã‚¸](https://opensearch.org/benchmarks/) ã§ç¢ºèªã§ãã¾ã™ã€‚

Calcite ã«ã‚ˆã‚Šã€PPL ã¯ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨æ¯”è¼ƒã—ã¦å¤§å¹…ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã‚’å®Ÿç¾ã—ã¾ã™ã€‚ã»ã¨ã‚“ã©ã® PPL ã‚³ãƒãƒ³ãƒ‰ã¨é–¢æ•°ã®å®Ÿè¡Œã¯ã€OpenSearch ã‚¯ã‚¨ãƒªãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰è¨€èª (DSL) ã«ãƒ—ãƒƒã‚·ãƒ¥ãƒ€ã‚¦ãƒ³ã•ã‚Œã€é‡ã„å¾Œå‡¦ç†ãŒå‰Šæ¸›ã•ã‚Œã¾ã™ã€‚è¿½åŠ ã®æ”¹å–„ã«ã¯ã€è¤‡åˆé›†ç´„ã€å¼·åŒ–ã•ã‚ŒãŸæ—¥ä»˜ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚µãƒãƒ¼ãƒˆã€å¤§ããªçµæœã‚»ãƒƒãƒˆã®ãŸã‚ã®ã‚ˆã‚Šè‰¯ã„ãƒ¡ãƒ¢ãƒªç®¡ç†ã€é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ”¹å–„ã•ã‚ŒãŸå‡¦ç†ãŒå«ã¾ã‚Œã¾ã™ã€‚ãŸã¨ãˆã°ã€Big5 PPL `date_histogram_hourly_agg` ã‚¯ã‚¨ãƒªã¯ç¾åœ¨ 160 å€é«˜é€Ÿã§ã€2.5 ç§’ã‹ã‚‰ 15 ãƒŸãƒªç§’ã«çŸ­ç¸®ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®æ©Ÿèƒ½å¼·åŒ–ã¯ã€ãƒ­ã‚°åˆ†æã‚„æ™‚ç³»åˆ—æ¢ç´¢ãªã©ã®ä¸€èˆ¬çš„ãªå¯è¦³æ¸¬æ€§ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åˆ©ç›Šã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚å®Œå…¨ãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ã€å¤œé–“ã®[ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://opensearch.org/benchmarks/) ã§å…¥æ‰‹ã§ãã¾ã™ã€‚

## CLI ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã„å§‹ã‚ã‚‹

æ—¢å­˜ã® OpenSearch ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãªãã€ä»Šæ—¥ã‹ã‚‰æ–°ã—ã„ PPL æ©Ÿèƒ½ã‚’æ¢ç´¢ã§ãã¾ã™ã€‚OpenSearch CLI ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã§ãã€å®Œå…¨ãªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«æ©Ÿèƒ½ã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚

é–‹å§‹æ–¹æ³•ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

1. **CLI ãƒ„ãƒ¼ãƒ«ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹**: æ–°ã—ã„ PPL æ©Ÿèƒ½ã‚’å«ã‚€ [OpenSearch SQL CLI README](https://github.com/opensearch-project/sql-cli/blob/main/README.md#installation-steps) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚
2. **OpenSearch ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«æ¥ç¶šã™ã‚‹** (ãƒ­ãƒ¼ã‚«ãƒ«ã¾ãŸã¯ãƒªãƒ¢ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«æ¥ç¶šã§ãã¾ã™):

   ```
   opensearchsql -e https://your-cluster-endpoint:your-port -u username:password
   ```

   æ¥ç¶šã™ã‚‹ã¨ã€CLI ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€SQL/PPL ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã«é–¢ã™ã‚‹æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

   ```
       ____                  _____                      __
     / __ \____  ___  ____ / ___/___  ____ ___________/ /_
   / / / / __ \/ _ \/ __ \\__ \/ _ \/ __ `/ ___/ ___/ __ \
   / /_/ / /_/ /  __/ / / /__/ /  __/ /_/ / /  / /__/ / / /
   \____/ .___/\___/_/ /_/____/\___/\__,_/_/   \___/_/ /_/
       /_/

   OpenSearch: v3.1.0
   Endpoint: https://your-cluster-endpoint:your-port
   User: admin
   SQL: v3.3.0.0
   Language: PPL
   Format: TABLE
   ```

3. **æ–°ã—ã„ PPL ã‚³ãƒãƒ³ãƒ‰ã®æ¢ç´¢ã‚’é–‹å§‹ã™ã‚‹**:

   ```
   PPL> source=user_activity | where duration > 200 | head 3
   ```

   CLI ã¯æ¬¡ã®çµæœã‚’è¿”ã—ã¾ã™ã€‚

   ```
   Executing: source=user_activity | where duration > 200 | head 3
   Fetched 3 rows with a total of 3 hits
   â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”“
   â”ƒ duration â”ƒ page_url     â”ƒ session_id â”ƒ @timestamp          â”ƒ user_id â”ƒ
   â”¡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”©
   â”‚ 240      â”‚ /product/456 â”‚ sess_001   â”‚ 2025-10-08 10:05:00 â”‚ user123 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ 240      â”‚ /product/456 â”‚ sess_001   â”‚ 2025-10-08 10:05:00 â”‚ user123 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ 300      â”‚ /product/123 â”‚ sess_002   â”‚ 2025-10-08 10:18:00 â”‚ user456 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ```

## PPL ã«å‚åŠ ã™ã‚‹

PPL ã®å°†æ¥ã¯ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®é–¢ä¸ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚CLI ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦æ–°æ©Ÿèƒ½ã‚’è©¦ã—ã€OpenSearch ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨çµŒé¨“ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚æ–°ã—ã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’æ¢ç´¢ã—ã¦ã„ã‚‹å ´åˆã§ã‚‚ã€æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚‹é ˜åŸŸã‚’ç‰¹å®šã—ã¦ã„ã‚‹å ´åˆã§ã‚‚ã€ã‚ãªãŸã®æ„è¦‹ã¯å¯è¦³æ¸¬æ€§æ©Ÿèƒ½ã®é–‹ç™ºã‚’å°ãã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚å ±å‘Šã‚’å®¹æ˜“ã«ã™ã‚‹ãŸã‚ã«ã€[ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](https://github.com/opensearch-project/sql/issues/new?template=ppl_bug_report.md) ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€æ¬¡ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- [OpenSearch PPL ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](https://github.com/opensearch-project/sql/blob/main/docs/user/ppl/index.rst)
- [PPL ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](https://github.com/opensearch-project/sql/issues/4287)
- [OpenSearch Slack ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹](https://opensearch.org/slack/)
