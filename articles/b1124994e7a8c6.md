---
title: "[ç¿»è¨³] OpenSearch ã«ãŠã‘ã‚‹éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥"
emoji: "ðŸ”"
type: "tech"
topics: ["opensearch", "cache", "performance"]
  - "opensearch"
publication_name: "opensearch"
published: true
published_at: "2025-05-27 12:30"
---

:::message
æœ¬è¨˜äº‹ã¯ [OpenSearch Project Blog](https://opensearch.org/blog/) ã«æŠ•ç¨¿ã•ã‚ŒãŸä»¥ä¸‹ã®è¨˜äº‹ã‚’æ—¥æœ¬èªžã«ç¿»è¨³ã—ãŸã‚‚ã®ã§ã™ã€‚
:::

https://opensearch.org/blog/tiered-cache/

## ã¯ã˜ã‚ã«

OpenSearch ã®ã‚ˆã†ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹é‡è¦–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¨ã£ã¦ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ä¸å¯æ¬ ãªæœ€é©åŒ–æ‰‹æ®µã§ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€å°†æ¥ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚ˆã‚Šé€Ÿãå‡¦ç†ã—ã€ã‚¯ã‚¨ãƒªã®å¿œç­”æ™‚é–“ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚OpenSearch ã¯ä¸»ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã® 2 ç¨®é¡žã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã©ã¡ã‚‰ã‚‚ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ã‚ã‚Šã€ãã®ã‚µã‚¤ã‚ºã¯ãƒŽãƒ¼ãƒ‰ä¸Šã§åˆ©ç”¨å¯èƒ½ãªãƒ’ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã®é‡ã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ã€‚

## ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ - è‰¯ã„ã‚¹ã‚¿ãƒ¼ãƒˆã ãŒã€ååˆ†ã‹ï¼Ÿ

OpenSearch ã«ãŠã‘ã‚‹ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒŽãƒ¼ãƒ‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹è¿…é€Ÿã€ã‚·ãƒ³ãƒ—ãƒ«ã€ã‹ã¤åŠ¹çŽ‡çš„ãªæ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚ä½Žãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’å®Ÿç¾ã—ã€å¤§å¹…ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å‘ä¸Šã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®åˆ©ç‚¹ã«ã¯ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãŒã‚ã‚Šã€ç‰¹ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå®¹é‡ã«è¿‘ã¥ãã¨å•é¡ŒãŒç”Ÿã˜ã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºãŒå®¹é‡ã«è¿‘ã¥ãã¨ã€å¤šæ•°ã®é€€é¿ï¼ˆevictionï¼‰ã¨ãƒŸã‚¹ãŒç™ºç”Ÿã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ä¸Šã®èª²é¡Œã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚µã‚¤ã‚ºã¯ã€ãƒŽãƒ¼ãƒ‰ã§åˆ©ç”¨å¯èƒ½ãªãƒ’ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã®é‡ã«ç›´æŽ¥é–¢é€£ã—ã¦ãŠã‚Šã€ã“ã‚Œã¯æœ‰é™ã§ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚Šã¾ã™ã€‚ã“ã®åˆ¶é™ã«ã‚ˆã‚Šã€å¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä¿å­˜ã—ãŸã‚Šã€å¤šæ•°ã®ã‚¯ã‚¨ãƒªã‚’ç®¡ç†ã—ãŸã‚Šã™ã‚‹éš›ã«èª²é¡ŒãŒç”Ÿã˜ã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå®¹é‡ã«é”ã™ã‚‹ã¨ã€æ–°ã—ã„ã‚¯ã‚¨ãƒªã®ãŸã‚ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ã€å¤ã„ã‚¯ã‚¨ãƒªã‚’é€€é¿ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®é »ç¹ãªé€€é¿ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒãƒ£ãƒ¼ãƒ³ã‚’å¼•ãèµ·ã“ã—ã€é€€é¿ã•ã‚ŒãŸã‚¯ã‚¨ãƒªãŒå¾Œã§å†è¨ˆç®—ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã«æ‚ªå½±éŸ¿ã‚’ä¸Žãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## ã‚ˆã‚Šè‰¯ã„æ–¹æ³•ã¯ãªã„ã‹ï¼Ÿ

å‰è¿°ã®ã‚ˆã†ã«ã€ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯å¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ç®¡ç†ã™ã‚‹éš›ã«åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã‚ŠåŠ¹æžœçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ã—ã¦éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯è¤‡æ•°ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ã‚’ä½¿ç”¨ã—ã€ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å§‹ã¾ã‚Šãƒ‡ã‚£ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®éšŽå±¤ã¾ã§æ‹¡å¼µã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã¨å®¹é‡ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã€è²´é‡ãªãƒ’ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»ã™ã‚‹ã“ã¨ãªãã€ã‚ˆã‚Šå¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä¿å­˜ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

éŽåŽ»ã«ã¯ã€å¾“æ¥ã®å›žè»¢å¼ãƒãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒ–ãŒé…ã‹ã£ãŸãŸã‚ã€ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã«æ‡¸å¿µãŒã‚ã‚Šã¾ã—ãŸã€‚ã—ã‹ã—ã€ç¾ä»£ã® SSD ã‚„ NVMe ãƒ‰ãƒ©ã‚¤ãƒ–ãªã©ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æŠ€è¡“ã®é€²æ­©ã«ã‚ˆã‚Šã€ã¯ã‚‹ã‹ã«é«˜é€Ÿãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã¯ã¾ã ãƒ¡ãƒ¢ãƒªã‚ˆã‚Šã‚‚é…ã„ã§ã™ãŒã€é€Ÿåº¦å·®ã¯ååˆ†ã«ç‹­ã¾ã£ã¦ãŠã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¯æœ€å°é™ã§ã‚ã‚Šã€å¤šãã®å ´åˆã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã®å¢—åŠ ã«ã‚ˆã‚‹åˆ©ç‚¹ã«ã‚ˆã£ã¦ç›¸æ®ºã•ã‚Œã¾ã™ã€‚

## éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä»•çµ„ã¿

éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã¨ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ç©ã¿é‡ã­ã‚‰ã‚ŒãŸè¤‡æ•°ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚ä¾‹ãˆã°ã€ç¬¬ 1 éšŽå±¤ã¯ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ã€æœ€ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãŒé«˜ã„ãŒã‚µã‚¤ã‚ºã¯å°ã•ã„ã§ã™ã€‚ç¬¬ 2 éšŽå±¤ã¯ãƒ‡ã‚£ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ã€é€Ÿåº¦ã¯é…ã„ãŒå¤§å¹…ã«å¤šãã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æä¾›ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ç”»åƒã¯éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¢ãƒ‡ãƒ«ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/c82c52bc2f5f-20250527.png)

OpenSearch ã¯ç¾åœ¨ã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¢ãƒ‡ãƒ«ã§ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—éšŽå±¤ã¨ãƒ‡ã‚£ã‚¹ã‚¯éšŽå±¤ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é€€é¿ã•ã‚Œã‚‹ã¨ã€ãã‚Œã¯ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ç§»å‹•ã—ã¾ã™ã€‚å„å—ä¿¡ã‚¯ã‚¨ãƒªã«å¯¾ã—ã¦ã€OpenSearch ã¯ã¾ãšãƒ‡ãƒ¼ã‚¿ãŒã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¾ãŸã¯ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã„ãšã‚Œã‹ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚è¦‹ã¤ã‹ã£ãŸå ´åˆã€å¿œç­”ã¯ã™ãã«è¿”ã•ã‚Œã¾ã™ã€‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ã‚¯ã‚¨ãƒªã¯å†è¨ˆç®—ã•ã‚Œã€çµæžœã¯ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®å›³ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/c981958d2fa7-20250527.png)

ç¾åœ¨ã€OpenSearch ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å¯¾ã—ã¦ã®ã¿éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥éšŽå±¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºã¯è¨­å®šå¯èƒ½ã§ã‚ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒŽãƒ¼ãƒ‰ä¸Šã®ãƒ’ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªã® 1% ã§ã™ã€‚éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ãƒ¡ãƒ¢ãƒªã«åŽã¾ã‚‰ãªã„å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä¿å­˜ã™ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥éšŽå±¤ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è² è·ãŒè»½æ¸›ã•ã‚Œã€å…¨ä½“çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãŒå‘ä¸Šã—ã¾ã™ã€‚

éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ãªè¨­è¨ˆã§ã™ã€‚éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šã‚’ä½¿ç”¨ã—ã¦ã€ç•°ãªã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Ÿè£…ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«çµ±åˆã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥](https://opensearch.org/docs/latest/search-plugins/caching/tiered-cache/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°

éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ç¾åœ¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã®ã¿é©ç”¨ã•ã‚Œã‚‹ãŸã‚ã€æ—¢å­˜ã®ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä¿å­˜ã™ã‚‹ã®ã«ååˆ†ãªå¤§ãã•ã§ãªãã€é »ç¹ãªé€€é¿ãŒç™ºç”Ÿã™ã‚‹å ´åˆã«å½¹ç«‹ã¡ã¾ã™ã€‚GET `/_nodes/stats/indices/request_cache` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®çµ±è¨ˆã‚’ç¢ºèªã—ã€é€€é¿ã€ãƒ’ãƒƒãƒˆã€ãƒŸã‚¹ã‚’ç›£è¦–ã§ãã¾ã™ã€‚é »ç¹ãªé€€é¿ã¨ã„ãã¤ã‹ã®ãƒ’ãƒƒãƒˆãŒè¦‹ã‚‰ã‚Œã‚‹å ´åˆã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã§å¤§å¹…ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ç‰¹ã«ä»¥ä¸‹ã®çŠ¶æ³ã§æœ‰ç›Šã§ã™ã€‚
* ãƒ‰ãƒ¡ã‚¤ãƒ³ã§å¤šãã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥é€€é¿ã¨ç¹°ã‚Šè¿”ã—ã‚¯ã‚¨ãƒªãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆã‚’ä½¿ç”¨ã—ã¦ç¢ºèªã§ãã¾ã™ã€‚
* ãƒ­ã‚°åˆ†æžã‚„èª­ã¿å–ã‚Šå°‚ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãªã©ã€ãƒ‡ãƒ¼ã‚¿ãŒé »ç¹ã«å¤‰æ›´ã•ã‚Œãšã€é »ç¹ãªé€€é¿ãŒç™ºç”Ÿã—ã¦ã„ã‚‹å ´åˆã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯é›†è¨ˆã‚¯ã‚¨ãƒªã®çµæžœã®ã¿ã‚’ä¿å­˜ã—ã¾ã™ã€‚`?request_cache=true` ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã€ç‰¹å®šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«ã§ãã¾ã™ã€‚

## éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹åŒ–æ–¹æ³•

éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€ãƒŽãƒ¼ãƒ‰è¨­å®šã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹åŒ–ã€ãŠã‚ˆã³å¿…è¦ã«å¿œã˜ã¦ä»–ã®è¨­å®šã®èª¿æ•´ãŒå«ã¾ã‚Œã¾ã™ã€‚è©³ç´°ãªæ‰‹é †ã«ã¤ã„ã¦ã¯ã€[éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://opensearch.org/docs/latest/search-plugins/caching/tiered-cache/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹çµæžœ

ã“ã®æ©Ÿèƒ½ã¯ç¾åœ¨å®Ÿé¨“çš„ã§ã‚ã‚Šã€æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ã¯æŽ¨å¥¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚’è©•ä¾¡ã™ã‚‹ãŸã‚ã«ã€ã„ãã¤ã‹ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã§ã¯ã€æ§˜ã€…ãªã‚¯ã‚¨ãƒªã‚¿ã‚¤ãƒ—ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆçŽ‡ã«ãŠã„ã¦ã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¯”è¼ƒã—ã¾ã—ãŸã€‚ã¾ãŸã€ç•°ãªã‚‹ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« (p25, p50, p75, p90, p99) ã‚‚æ¸¬å®šã—ã¾ã—ãŸã€‚

### ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

* ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—: c5.4xl
* ãƒŽãƒ¼ãƒ‰æ•°: 1
* åˆè¨ˆãƒ’ãƒ¼ãƒ—ã‚µã‚¤ã‚º: 16 GB
* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
  * ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚º: 40 MB
* éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
  * ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚º: 40 MB
  * ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚º: 1 GB

OpenSearch Benchmark ã® nyc_taxis ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã—ãŸãŒã€çµ±è¨ˆçš„ã«å†ç¾å¯èƒ½ãªã‚¯ã‚¨ãƒªã‚’ç™ºè¡Œã™ã‚‹ãŸã‚ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚å…ƒã®ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯ã¯å¸¸ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹ã«ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ã‚¯ã‚¨ãƒªã®ç¹°ã‚Šè¿”ã—ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨±å¯ã—ã¾ã›ã‚“ã€‚ã“ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã‚ˆã‚Šé©åˆ‡ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€ç›®æ¨™ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆçŽ‡ã‚’ãƒ†ã‚¹ãƒˆã—ã€ã‚¯ã‚¨ãƒªã®ç¹°ã‚Šè¿”ã—ã®å¤‰å‹•ã‚’è€ƒæ…®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¯ã€ã‚·ãƒ£ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã«ã‚ˆã£ã¦åˆ†é¡žã•ã‚ŒãŸã‚¯ã‚¨ãƒªã®æ··åˆã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
* é«˜ã‚³ã‚¹ãƒˆ (>150 ms)
* ä¸­ç¨‹åº¦ (10â€“150 ms)
* ä½Žã‚³ã‚¹ãƒˆ (<10 ms)

ä»¥ä¸‹ã®å›³ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ†ã‚¹ãƒˆçµæžœã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚èµ¤ã„åž‚ç›´ç·šã¯ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã®ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ã‚’ç¤ºã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹ã§éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç„¡åŠ¹ã®çŠ¶æ…‹ã§ã™ã€‚0%ã€30%ã€70% ã®ã‚¯ã‚¨ãƒªå†ç¾æ€§ã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã€ã“ã‚Œã‚‰ã¯ç•°ãªã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆçŽ‡ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/7cccddaf10cc-20250527.png)

åˆæœŸçµæžœã¯ã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç‰¹ã«é«˜ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆçŽ‡ã¨ p75 æœªæº€ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã§è‰¯å¥½ã«æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«è¨ˆç®—ã‚³ã‚¹ãƒˆã®é«˜ã„ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ãã‚Œã‚‰ã‚’å†è¨ˆç®—ã™ã‚‹å¿…è¦æ€§ã‚’æ¸›ã‚‰ã—ã€ä»£ã‚ã‚Šã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ç›´æŽ¥çµæžœã‚’å–å¾—ã™ã‚‹ãŸã‚ã€åˆ©ç‚¹ãŒé¡•è‘—ã§ã™ã€‚

## ä»Šå¾Œã®äºˆå®š

éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯æœ‰æœ›ãªæ©Ÿèƒ½ã§ã™ãŒã€ã•ã‚‰ãªã‚‹æ”¹å–„ã«ç©æ¥µçš„ã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã™ã€‚ç¾åœ¨ã€éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚ˆã‚Šé«˜æ€§èƒ½ã«ã™ã‚‹æ–¹æ³•ã‚’æ¨¡ç´¢ã—ã¦ã„ã¾ã™ã€‚å°†æ¥ã®å¼·åŒ–ã«ã¯ã€é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã‚ªãƒ³ãƒ’ãƒ¼ãƒ—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ã€å†èµ·å‹•é–“ã§ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã™ã‚‹ã“ã¨ã€ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã©ã®ä»–ã® OpenSearch ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒ—ã¨éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’çµ±åˆã™ã‚‹ã“ã¨ãªã©ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚[ã“ã® Issue](https://github.com/opensearch-project/OpenSearch/issues/10024) ã§é€²æ—çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚éžæœ¬ç•ªç’°å¢ƒã§éšŽå±¤åž‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è©¦ã—ã€ã“ã®æ©Ÿèƒ½ã®æ”¹å–„ã«å½¹ç«‹ã¤ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚
