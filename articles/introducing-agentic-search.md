---
publication_name: "opensearch"
title: "[翻訳] OpenSearch におけるエージェント型検索の導入：自然言語によるデータ操作の変革"
emoji: "🤖"
type: "tech"
topics:
  - "opensearch"
published: true
published_at: 2025-11-24
---

:::message
本記事は [OpenSearch Project Blog](https://opensearch.org/blog/) に投稿された以下の記事を日本語に翻訳したものです。
:::

https://opensearch.org/blog/introducing-agentic-search-in-opensearch-transforming-data-interaction-through-natural-language/

OpenSearch 3.3 では、データとのインタラクション方法を大きく変える新機能「エージェント型検索」を導入しました。エージェント型検索を使用すると、複雑なクエリ構文を手動で作成したり、専門的な DSL (ドメイン固有言語) を学んだりすることなく、自然言語でデータを簡単に探索できます。

## エージェント型検索の基本概念

エージェント型検索は、主に「エージェント」と「ツール」という 2 つの要素で構成されています。

### エージェント

エージェントとは、大規模言語モデル (LLM) を搭載したシステムで、ユーザーの要求を解釈し、必要な手順を計画し、適切なツールを選択する機能を備えています。このシステムはユーザーの意図を理解し、タスクを具体的なアクションに分解し、中間結果に基づいて柔軟に対応を調整します。

### ツール

ツールとは、エージェントが呼び出せる機能のことで、インデックスの一覧表示や検索操作などが該当します。エージェントはクエリの意図に基づいて使用するツールを選択します。組み込みツールの一覧については、[ツール](https://docs.opensearch.org/latest/ml-commons-plugin/agents-tools/tools/index/)のページをご覧ください。

## エージェント型検索の仕組み

エージェント型検索は、インテリジェントなエージェント駆動システムによって実現されています。このシステムは自然言語による検索クエリを解釈し、適切なツールを選択して最適化された検索戦略を自動生成します。`agentic` クエリタイプを使用することで、クエリ構文や内部データ構造の知識がなくても、直感的な自然言語でデータ探索を行えます。

例えば、以下のような質問が可能です。

- 3 万ドル以下の赤い車をすべて検索してください
- 前四半期の靴カテゴリーにおける販売動向を一覧表示してください
- 電子機器カテゴリで最も売上実績の高い製品は何ですか?

エージェントは、関連するインデックスの特定、クエリの計画、補助情報の収集といった必要な手順を実行し、ユーザーの意図に沿った結果を返します。さらに、使用したツールや判断プロセスについても詳細な説明を提供します。

OpenSearch 3.3 では、データとの自然で対話的なやり取りを可能にするとともに、システム間の高度な連携を実現する複数の主要機能が導入されています。

### 会話型検索体験

メモリ ID を使用してクエリ間のコンテキストを維持することで、前のクエリを基盤としたシームレスなマルチターン対話が可能になります。エージェントはコンテキストを追跡し、それに応じてクエリプランを更新するため、詳細を繰り返し説明することなく、自然にクエリを洗練させたり追加の質問をしたりできます。詳細については、[エージェント型検索における会話型エージェントの活用](https://docs.opensearch.org/latest/ml-commons-plugin/agents-tools/tools/index/)をご覧ください。

### 組み込みツール

エージェント型検索では、組み込みツールを使用して情報の取得、理解、充実化を行います。`ListIndexTool` はクラスタ内のインデックスを特定し、`IndexMappingTool` はエージェントが各インデックスの構造とフィールドを理解するのを支援します。`QueryPlanningTool` は、自然言語での質問を最適化されたクエリに変換します。ローカルデータだけでは完全な回答が得られない場合、`WebSearchTool` が関連する外部情報を検索します。

例えば、以下のような質問が可能です。

- ロナウドのお気に入りの靴に似た商品を表示してください
- ゴルフをするために必要なアイテムは何ですか?

エージェントがインデックス内に十分な情報を見つけられない場合、ウェブ検索を実行して追加のコンテキスト情報を収集し、ローカルデータと比較して最も関連性の高い結果を返します。

### カスタム検索テンプレート

上級ユーザーは、既知の検索戦略やドメイン固有のロジックを定義した[カスタム検索テンプレート](https://docs.opensearch.org/latest/vector-search/ai-search/agentic-search/search-templates/)を作成できます。エージェントは、ユーザーの質問や会話のコンテキストに基づいて、最も適切なテンプレートを自動的に選択・適用します。このハイブリッド方式により、ドメイン固有の知識を活用しながら、自然言語インターフェースで操作できます。

### 外部システムとの連携

Model Context Protocol (MCP) コネクタを使用して外部システムに接続することで、OpenSearch クラスターの範囲を超えて検索機能を拡張できます。MCP は外部データソースやサービスとの連携を標準化したプロトコルです。外部 MCP サーバーや計算環境に接続することで、エージェントは複数のシステムにまたがるクエリの計画と実行を調整できます。これにより、サードパーティサービスのデータを活用した高度なワークフローが可能になります。詳細については、[外部 MCP サーバーの使用](https://docs.opensearch.org/latest/vector-search/ai-search/agentic-search/mcp-server/)をご覧ください。

## エージェント型検索が他の検索方式と異なる点

OpenSearch Dashboards の「検索結果比較」ツールを使用すると、さまざまなクエリとその結果を実際に試せます。詳細については、[単一クエリの比較](https://docs.opensearch.org/latest/search-plugins/search-relevance/compare-search-results/)をご覧ください。

エージェント型検索の特徴を理解するために、「父に黒いサングラスを買ってあげたい」というクエリ (Compare Search Results ツールでは `%SearchText%` として入力) を例に考えてみましょう。

### エージェント型検索とキーワード検索の比較

エージェント型検索とキーワード検索を比較するため、以下のクエリを実行してください。

**エージェント型クエリ**

```json
{
  "query": {
    "agentic": {
      "query_text": "%SearchText%",
      "query_fields": []
    }
  }
}
```

**キーワード検索クエリ**

```json
{
  "query": {
    "multi_match": {
      "query": "%SearchText%"
    }
  }
}
```

エージェント型検索 (左) とキーワード検索 (右) の検索結果を以下に示します。

![](/images/introducing-agentic-search/introducing-agentic-search-2025-11-25.webp)

**エージェント型検索**では、「shades」がサングラスを指しており、「dad」という単語との一致ではなく購入を意図していることを正確に理解します。インデックス内の製品カテゴリ情報を活用して、適切なサングラス製品を検索結果として返します。

**キーワード検索**では、「want (欲しい)」「buy (購入する)」「black (黒)」「shades (シェード)」「dad (父)」といった個々の単語が個別に照合されるため、窓用シェードやその他黒い物体に関する無関係な結果が返される可能性があります。

### エージェント型検索とセマンティック検索の比較

エージェント型検索とセマンティック検索を比較するため、以下のクエリを実行してください。

**エージェント型クエリ**

```json
{
  "query": {
    "agentic": {
      "query_text": "%SearchText%",
      "query_fields": []
    }
  }
}
```

**セマンティック検索クエリ**

```json
{
  "query": {
    "neural": {
      "content_embedding": {
        "query_text": "%SearchText%",
        "k": 100,
        "model_id": "IX-eM5oBVLB2ECqF42kS"
      }
    }
  }
}
```

エージェント型検索 (左) とセマンティック検索 (右) の検索結果を以下に示します。

![](/images/introducing-agentic-search/introducing-agentic-search-2025-11-25_1.webp)

**エージェント型検索**では、文脈全体とユーザーの目的をより深く理解し、贈り物に適した黒いサングラスという特定の条件に焦点を絞って検索を行います。

**セマンティック検索**は、文脈の意味を理解し、「shades」をサングラスとして正しく認識します。ただし、クエリのすべての単語を処理するため、黒色のもの全般に関する結果も返してしまう可能性があります。これは、ユーザーの意図を完全に理解していないためです。

これらの比較からわかるように、エージェント型検索の最大の特徴は、キーワードマッチングや単純な意味的類似性を超えて、ユーザーの意図を深く理解し、適切なツールを選択し、必要に応じて外部情報も活用しながら検索を行う点にあります。

## 実際の使用事例

以下の使用例では、インデックス構造やクエリ構文、検索最適化の知識がなくても、エージェント型検索がさまざまな業界のシナリオに対応できることを示しています。

補足: MCP サーバーの情報は [Awesome MCP Servers](https://mcpservers.org/) から入手できます。

### パーソナライズされたショッピング推薦

**検索クエリ**

- 過去の注文履歴と閲覧行動に基づいて、私好みのランニングシューズを表示してください

**処理の流れ**

- エージェントは `ListIndexTool` を使用して、products などの関連インデックスを特定します。
- 過去の購入履歴、好みのブランド、サイズ、価格帯などの情報を取得するために、`get_order_history` MCP ツールを呼び出します。
- インデックスマッピングと MCP が提供する注文データを使用して、エージェントは `QueryPlanningTool` で最適化された DSL クエリを自動構築します。

**効果**

行動データ、意味的シグナル、トレンドを統合した、高度にカスタマイズされた製品レコメンドを提供します。手動でクエリを作成する必要はありません。

### オブザーバビリティとインシデント相関分析

**検索クエリ**

- 今朝の停電の影響を受けた顧客を教えてください

**処理の流れ**

- エージェントは `ListIndexTool` を使用して、`logs`、`metrics`、`alerts` などの関連する運用インデックスを選択します。
- カスタムインシデント管理 MCP ツールを使用して、公式のインシデント詳細を取得し、ログデータと相関分析を行います。
- `IndexMappingTool` を使用して、タイムスタンプ、サービスフィールド、顧客識別子を解釈します。
- 必要に応じて、`WebSearchTool` が公開のサービス停止アナウンスなどの外部情報を検証します。
- `QueryPlanningTool` を使用して DSL クエリを作成し、障害発生時間帯のログをフィルタリングして、エラー件数が急増した顧客や活動量が減少した顧客を特定します。

**効果**

影響を受けた顧客に関する完全かつ相関性のあるビューを自動生成し、ログデータ、メトリクス、インシデントデータ、外部コンテキスト情報を統合します。

### 不正検知およびリスク調査

**検索クエリ**

- 過去 24 時間以内に行われた疑わしい不正取引を特定してください

**処理の流れ**

- エージェントは `ListIndexTool` を使用して `transactions` インデックスを特定します。
- `IndexMappingTool` を使用して、金額、場所、device_id、加盟店、タイムスタンプなどの主要フィールドを認識します。
- カスタム不正検知ルールエンジン MCP ツールを使用して、事前定義されたルールを取得し、リスクスコアに基づいて結果をランク付けします。
- `QueryPlanningTool` を使用して、地理的距離の異常や取引頻度の不自然な変動などを検出する最適化された DSL クエリを構築します。

**効果**

OpenSearch の異常検知機能、外部ルールエンジン、データエンリッチメントを統合した自動化された不正トリアージにより、手動調査時間を大幅に短縮します。

## ML Playground でエージェント型検索をお試しください

エージェント型検索は、設定済みエージェントとサンプルデータが利用可能な[機械学習 (ML) プレイグラウンド](https://ml.playground.opensearch.org/app/opensearch-flow#/workflows/yjn5LZoBjktoC8RhTWUk?configureAgent=false)でご体験いただけます。

## エージェント型検索をローカル環境に設定する

ローカル環境でエージェント型検索を設定するには、[エージェント型検索のセットアップ手順](https://docs.opensearch.org/latest/vector-search/ai-search/agentic-search/index/)を参照してください。

検索結果の詳細な説明を表示するには、[エージェントコンテキストプロセッサ](https://docs.opensearch.org/latest/search-plugins/search-pipelines/agentic-context-processor/)を設定してください。この説明には、エージェントが結果を生成するために実行した手順や、使用したツールに関する情報が含まれます。以下にその例を示します。

![](/images/introducing-agentic-search/introducing-agentic-search-2025-11-25_2.webp)

## OpenSearch Dashboards でエージェント型検索を使用する

OpenSearch Dashboards でエージェント型検索を使用するには、以下の手順で行います。

1. **OpenSearch プラグイン** > **AI 検索フロー**に移動します。
2. **新規ワークフローの作成**を選択し、エージェント型検索を選択します。
3. 設定内容を保存するため、ワークフロー名を入力します。
4. **作成**を選択して、エージェント型検索インターフェースを開きます。

このインターフェースには主に 2 つのセクションがあります。

- **左パネル**: エージェントの設定と作成を行います。
- **右パネル**: 検索を実行し、結果を分析します。

詳細な手順については、[エージェント型検索](https://docs.opensearch.org/latest/vector-search/ai-search/building-agentic-search-flows/)のドキュメントを参照してください。

## 今後の予定

現在、エージェント型検索のさらなる性能最適化に取り組んでおり、プロンプトキャッシュ機能、マルチエージェントアーキテクチャ、エージェント追跡機能の改善などを実装中です。評価フレームワークやクエリ精度、ユーザー体験に関する詳細なブログ記事を今後公開する予定です。

ご意見、ご質問、または実装を希望する追加ユースケースのアイデアがございましたら、ぜひお知らせください。[OpenSearch フォーラム](https://forum.opensearch.org/t/use-cases-and-general-feedback-for-agentic-search/27488)または [OpenSearch Slack ワークスペース](https://opensearch.org/slack/)でのディスカッションにご参加ください。

現在進行中の開発状況や設計変更については、[エージェント型検索の RFC](https://github.com/opensearch-project/neural-search/issues/1525) を参照してください。
