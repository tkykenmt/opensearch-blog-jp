---
title: "[翻訳] OpenSearch Kubernetes Operator に安定性と回復力をもたらす"
emoji: "🔍"
type: "tech"
topics: ["opensearch", "kubernetes", "operator"]
publication_name: "opensearch"
published: true
published_at: 2026-01-27
---

:::message
本記事は [OpenSearch Project Blog](https://opensearch.org/blog/) に投稿された以下の記事を日本語に翻訳したものです。
:::

https://opensearch.org/blog/bringing-stability-and-resilience-to-the-opensearch-kubernetes-operator/

# OpenSearch Kubernetes Operator に安定性と回復力をもたらす

この数か月間で、OpenSearch Kubernetes Operator はセキュリティ、安定性、柔軟性、運用機能の面で大幅な改善が行われました。 OpenSearch Kubernetes Operator の 3.0 アルファリリースを発表できることを嬉しく思います。このリリースには、重大なバグ、機能リクエスト、利便性の改善に対応する 100 以上の重要な変更が含まれています。

## v2.8.0 以降の 3.0 の新機能

OpenSearch Kubernetes Operator 3.0 リリースは、回復力と正確性に重点を置いています。以前のバージョンでは、エラー状態やアップグレード時にクラスターの安定性に影響を与える重大な問題があり、複数の顧客、環境、規模にわたって確認されていました。このリリースでは、安定性を実現するために大幅な書き直しが行われました。

以下のセクションでは、このリリースの主要な変更点を紹介します。すべてを網羅しているわけではありませんが、更新の範囲とこのリリースの重要性を示しています。

### 運用の卓越性

このリリースには、以下の運用の卓越性に関する改善が含まれています。

**クォーラムセーフなローリングリスタートと SmartScaler のデフォルト有効化** – Operator は、ノードプール全体でインテリジェントかつ安全なローリングリスタートを実行し、クラスターのクォーラムを維持します。これにより、スプリットブレインを防止し、マルチアベイラビリティーゾーンやマルチティア環境などの複雑なデプロイメントにおけるダウンタイムとアップグレードの信頼性が向上します。

**マルチネームスペースサポート** – 複数のネームスペースにまたがるクラスターを管理できるようになり、マルチテナントデプロイメントと組織的な分離のサポートが向上しました。この長年要望されていた機能により、共有環境でのより柔軟なクラスター管理が可能になります。

**ネームスペーススコープのロールベースアクセス制御（RBAC）** – Helm チャートがネームスペースをサポートするようになり、マルチテナントデプロイメントと組織的な分離が改善されました。

**データ整合性テストフレームワーク** – 新しい包括的なテストフレームワークにより、クラスター操作中のデータ整合性を検証し、リカバリとアップグレードの正確性を確認する補助的なシステムテストが含まれています。このリリースの関連するすべての変更は、厳格な自動テストを通じて検証されました。

**PVC バックアップのブートストラップ Pod** – ブートストラップ Pod が設定可能なディスクサイズの `PersistentVolumeClaims`（PVC）を使用するようになり、大規模クラスターや低速ネットワークでの初期化の信頼性が向上しました。

**ブートストラップ Pod のカスタマイズ** – ブートストラップ Pod へのカスタムアノテーションとラベルにより、モニタリング、ネットワーキング、セキュリティポリシー全体での統合が改善されました。ブートストラップ中のプラグインインストールもサポートされるようになりました。

### TLS 証明書の効率化

このリリースには、 TLS 証明書管理を簡素化する以下の機能強化が含まれています。

**TLS 証明書のホットリロード** – クラスターは Pod の再起動なしに TLS 証明書を自動的にリロードし、シームレスなローテーションを可能にします。さらに、開発およびテスト環境向けに新しい `DisableSSL` オプションが利用可能です。

**設定可能な証明書の有効期間** – 証明書の有効期間を組織のセキュリティポリシーに合わせることができます。

### 柔軟性とカスタマイズ

このリリースでは、以下の柔軟性とカスタマイズオプションが追加されました。

**Init コンテナとサイドカー** – OpenSearch と Dashboard の両方の Pod で完全にサポートされ、カスタム初期化、ログ転送、モニタリングエージェント、サービスメッシュ統合が可能になりました。

**Network File System（NFS）ボリュームサポート** – 標準の `PersistentVolumeClaims` と並行して NFS ボリュームを使用できます。

**カスタム PVC ラベル・アノテーションとトポロジー分散制約** – ストレージオペレーター、バックアップソリューション、ポリシーエンジンとのより良い統合が可能になりました。

**ホストエイリアス** – カスタムホストエイリアスにより、カスタム DNS 解決を必要とする外部サービスとの統合が簡素化されます。

### Operator インフラストラクチャの改善

このリリースには、以下の Operator インフラストラクチャの改善が含まれています。

**kube-rbac-proxy の削除** – ネイティブの controller-runtime 認証・認可に置き換えられ、デプロイメントアーキテクチャが簡素化され、リソースオーバーヘッドが削減されました。

**Prometheus メトリクスとモニタリング** – アップストリームの Prometheus Operator との正しい API バージョンの整合性と、カスタムモニタリングラベルのサポートが追加されました。

**gRPC ポート** – 完全に設定可能な形で公開されるようになり、 [OpenSearch 3.0 の新しい gRPC サポート](https://docs.opensearch.org/latest/api-reference/grpc-apis/index/) を使用できるようになりました。

### 重大なバグ修正

このリリースには、以下の重大なバグ修正が含まれています：

- OpenSearch 3.0.0 へのアップグレード時のデッドロックを解決
- プレリリースバージョンのバージョン制約チェックを修正
- アップグレード中のノードバージョン不一致検出を修正
- `additionalConfig` と環境変数の適用を修正
- 管理者証明書の生成と SSL 検証モードの処理を修正
- JVM ヒープサイズパラメータが適用されない問題を修正
- 再作成ループを引き起こす不正な Pod スペック更新を防止

## 利便性の改善

このリリースには、以下の利便性の改善が含まれています：

- デフォルトの Pod アンチアフィニティルールによるコロケーション防止
- Operator Pod のプライオリティクラスサポート
- データディレクトリの適切なユーザー/グループ所有権の処理
- 専用コーディネーターノードプールサポートの強化
- 設定可能な JSON ログメッセージキー
- Helm 環境変数によるネームスペースオーバーライド
- より良いサービスメッシュ統合のための `appProtocol` フィールド

## 移行に関する注意事項

Operator は `opensearch.opster.io/v1` から `opensearch.org/v1` API グループへの移行を進めており、 OpenSearch プロジェクトのブランディングとの整合性を反映しています。

### タイムライン

- **OpenSearch 3.0**：両方の API グループをサポート
- **非推奨期間**：2〜3 回のメジャーリリース（旧 API グループは非推奨警告をログに出力）
- **将来のリリース**：`opensearch.opster.io` を削除

### 自動移行

Operator には移行を自動的に処理する移行コントローラーが含まれています：

- **自動同期**：`opensearch.opster.io/v1` で作成されたリソースは、対応する `opensearch.org/v1` リソースを自動的に作成します。
- **ステータス同期**：新旧リソース間の双方向同期。
- **削除処理**：旧 API リソースを削除すると、対応する新しいリソースも削除されます。

### 手動移行手順

クリーンな移行のために、マニフェストを更新してください：

```yaml
# 旧
apiVersion: opensearch.opster.io/v1
# 新
apiVersion: opensearch.org/v1
```

ラベルセレクターを更新してください（例：`opster.io/opensearch-cluster` を `opensearch.org/opensearch-cluster` に変更）。

Helm デプロイメントの場合、以下のように設定を更新してください：

```yaml
apiGroup: opensearch.org # デフォルト（推奨）
```

詳細な手順とリソースマッピングについては、 [移行ガイド](https://github.com/opensearch-project/opensearch-k8s-operator/blob/main/docs/userguide/migration-guide.md) を参照してください。

### 破壊的変更

**アップグレード前にこれらの破壊的変更を確認してください：**

- **SmartScaler** – デフォルトで有効になりました。不要な場合は明示的に無効にしてください。
- **Kube-rbac-proxy** – 削除されました。カスタムモニタリング設定を適宜更新してください。
- **SetVMMaxMapCount** – デフォルトで true になりました。
- **バリデーション Webhook** – アクティブで、無効な設定を拒否します。まず非本番環境でテストしてください。
- **セキュリティ TLS** – トランスポートと REST API の両方でデフォルトで有効になりました。
- **デフォルトパスワード** – 固定のデフォルトは設定されません。パスワードを明示的に指定するか、自動生成されたパスワードを受け入れてください。

## 今後の予定

このリリースは、 OpenSearch Kubernetes Operator にとって大きな前進であり、運用の安全性の向上、カスタマイズの拡大、本番環境への対応力の強化を実現しています。 OpenSearch Kubernetes Operator を使用している場合は、以前の Operator リリースが本番環境で重大な問題を示していたため、最新バージョンへのアップグレードをお勧めします。

これはアルファリリースですが、既存のユーザーが試すのに十分な安定性があると考えています。まず開発環境やステージング環境から始め、信頼性が高まるにつれて本番環境へ進めることをお勧めします。

このリリース後の数週間で、重大な問題が発生しない（または発見されたすべての問題が解決されテストされた）場合、 Operator のベータバージョンをリリースする予定です。ベータリリースでリリースブロッカーが見つからなくなってから 2 週間後に、一般提供版の OpenSearch Kubernetes Operator 3.0 を出荷する予定です。

## 次のステップ

新しい Operator をぜひお試しください。構築とテストに多大な労力が費やされており、皆様のフィードバックを楽しみにしています。 Issue の報告、 PR の作成、そして [GitHub での会話](https://github.com/opensearch-project/opensearch-k8s-operator)、OpenSearch パブリック Slack の [#k8s-operator チャンネル](https://opensearch.slack.com/archives/C06QRV1RLD7)、[OpenSearch Community フォーラム](https://forum.opensearch.org/) への参加をお待ちしています。

## 謝辞

[BigData Boutique](https://bigdataboutique.com/) のチーム（Jose Barato、Ryan Patterson、Lior Friedler）、そしてベテランメンテナーの Prudhvi Godithi に、この重要なマイルストーンの達成に向けた尽力と支援に感謝いたします。また、テスト、フィードバックの提供、新しい Operator の改善に貢献してくださった OpenSearch コミュニティのコントリビューターの皆様にも感謝の意を表します。
