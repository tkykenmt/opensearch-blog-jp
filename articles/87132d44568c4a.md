---
title: "OpenSearch 2.13 ã§ æ—¥æœ¬èªã®ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆãŒå®Ÿè£…ã—ã‚„ã™ããªã‚Šã¾ã—ãŸ"
emoji: "ğŸŒŸ"
type: "tech"
topics: ["opensearch", "japanese", "autocomplete", "search"]
publication_name: "opensearch"
published: true
published_at: "2024-05-21 23:14"
---

## ã¾ãˆãŒã

OpenSearch 2.13 ã®[ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ](https://github.com/opensearch-project/documentation-website/blob/main/release-notes/opensearch-documentation-release-notes-2.13.0.md?plain=1#L30)ã‚’èª­ã‚“ã§ã„ãŸã¨ã“ã‚ã€ä»¥ä¸‹ã®è¨˜è¿°ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚

> - Add documentation for kuromoji_completion filter [#6699](https://github.com/opensearch-project/documentation-website/pull/6699)

[OpenSearch ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://opensearch.org/docs/2.13/analyzers/token-filters/index/) ã«ã‚ˆã‚‹ã¨ã€æ—¥æœ¬èªã‚’ãƒ­ãƒ¼ãƒå­—ã®ã‚¿ãƒ¼ãƒ ã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã®ä»•çµ„ã¿ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

> Adds Japanese romanized terms to the token stream (in addition to the original tokens). Usually used to support autocomplete on Japanese search terms. Note that the filter has a mode parameter, which should be set to index when used in an index analyzer and query when used in a search analyzer. Requires the analysis-kuromoji plugin. For information about installing the plugin, see Additional plugins.

## å‹•ä½œç¢ºèª

ã§ã¯å®Ÿéš›ã«è©¦ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚æœ¬è¨˜äº‹ã§ã¯ã€OSS ç‰ˆã® OpenSearch 2.13 ã« Kuromoji ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

ã¾ãšã€ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

```
PUT kuromoji_completion_sample
{
  "mappings": {
    "properties": {
      "suggestion": {
        "type": "completion",
        "analyzer": "kuromoji_completion_index",
        "search_analyzer": "kuromoji_completion_query",
        "preserve_separators": false,
        "preserve_position_increments": true,
        "max_input_length": 20
      }
    }
  },
  "settings": {
    "index": {
      "number_of_shards": "1",
      "analysis": {
        "analyzer": {
          "kuromoji_completion_index": {
            "mode": "index",
            "type": "kuromoji_completion"
          },
          "kuromoji_completion_query": {
            "mode": "query",
            "type": "kuromoji_completion"
          }
        }
      }
    }
  }
}

```

æ¬¡ã«ã€ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½ã‚’è©¦ã™ãŸã‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```
PUT kuromoji_completion_sample/_doc/1
{
  "suggestion": ["æ±äº¬éƒ½"]
}

PUT kuromoji_completion_sample/_doc/2
{
  "suggestion": ["é³¥å–çœŒ"]
}

PUT kuromoji_completion_sample/_doc/3
{
  "suggestion": ["åŒ—æµ·é“"]
}

PUT kuromoji_completion_sample/_doc/4
{
  "suggestion": ["åƒè‘‰çœŒ"]
}
```

ã§ã¯ã‚µã‚¸ã‚§ã‚¹ãƒˆã‚’è¡Œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"ã¨" ã¨å…¥åŠ›ã—ãŸå ´åˆã®çµæœã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

```
GET kuromoji_completion_sample/_search
{
  "suggest": {
    "suggest": {
      "prefix": "ã¨",
      "completion": {
        "field": "suggestion"
      }
    }
  }
}
```

```
{
  "took": 0,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 0,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "suggest": {
    "suggest": [
      {
        "text": "ã¨",
        "offset": 0,
        "length": 1,
        "options": [
          {
            "text": "æ±äº¬éƒ½",
            "_index": "kuromoji_completion_sample",
            "_id": "1",
            "_score": 1,
            "_source": {
              "suggestion": [
                "æ±äº¬éƒ½"
              ]
            }
          },
          {
            "text": "é³¥å–çœŒ",
            "_index": "kuromoji_completion_sample",
            "_id": "2",
            "_score": 1,
            "_source": {
              "suggestion": [
                "é³¥å–çœŒ"
              ]
            }
          }
        ]
      }
    ]
  }
}
```

æ±äº¬éƒ½ã¨é³¥å–ãŒå‡ºã¦ãã¾ã—ãŸã€‚ã§ã¯ã€t ã¨ã ã‘å…¥åŠ›ã—ãŸå ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```
GET kuromoji_completion_sample/_search
{
  "suggest": {
    "suggest": {
      "prefix": "t",
      "completion": {
        "field": "suggestion"
      }
    }
  }
}
```

```
{
  "took": 1,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 0,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "suggest": {
    "suggest": [
      {
        "text": "t",
        "offset": 0,
        "length": 1,
        "options": [
          {
            "text": "åƒè‘‰çœŒ",
            "_index": "kuromoji_completion_sample",
            "_id": "4",
            "_score": 1,
            "_source": {
              "suggestion": [
                "åƒè‘‰çœŒ"
              ]
            }
          },
          {
            "text": "æ±äº¬éƒ½",
            "_index": "kuromoji_completion_sample",
            "_id": "1",
            "_score": 1,
            "_source": {
              "suggestion": [
                "æ±äº¬éƒ½"
              ]
            }
          },
          {
            "text": "é³¥å–çœŒ",
            "_index": "kuromoji_completion_sample",
            "_id": "2",
            "_score": 1,
            "_source": {
              "suggestion": [
                "é³¥å–çœŒ"
              ]
            }
          }
        ]
      }
    ]
  }
}
```

ä»Šåº¦ã¯åƒè‘‰çœŒã‚‚å‡ºã¦ãã¾ã—ãŸã­ã€‚
ã§ã¯ "ãƒˆï½”ï½”" ã§æ¤œç´¢ã—ã¦ã¿ã¾ã™ã€‚

```
GET kuromoji_completion_sample/_search
{
  "suggest": {
    "suggest": {
      "prefix": "ãƒˆï½”ï½”",
      "completion": {
        "field": "suggestion"
      }
    }
  }
}
```

```
{
  "took": 1,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 0,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "suggest": {
    "suggest": [
      {
        "text": "ãƒˆï½”ï½”",
        "offset": 0,
        "length": 3,
        "options": [
          {
            "text": "é³¥å–çœŒ",
            "_index": "kuromoji_completion_sample",
            "_id": "2",
            "_score": 1,
            "_source": {
              "suggestion": [
                "é³¥å–çœŒ"
              ]
            }
          }
        ]
      }
    ]
  }
}
```

é³¥å–çœŒã ã‘ãŒãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚ã“ã®ã‚ˆã†ã«ã‹ãª/ã‚«ãƒŠã¨è‹±å­—ãŒç¹”ã‚Šäº¤ã˜ã£ã¦ã„ã¦ã‚‚ã‚µã‚¸ã‚§ã‚¹ãƒˆãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

Analyze API ã‚’ä½¿ã£ã¦ã¿ã¦ã¿ã‚‹ã¨ã€å„ãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒ­ãƒ¼ãƒå­—ã«å¤‰æ›ã•ã‚Œã¦ã‚¤ãƒ³ãƒ‡ã‚¯ã‚·ãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã‚µã‚¸ã‚§ã‚¹ãƒˆæ™‚ã«ã‚¯ã‚¨ãƒªãƒ†ã‚­ã‚¹ãƒˆã«å¯¾ã—ã¦ã‚‚åŒæ§˜ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€å‰æ–¹ä¸€è‡´ã«ã‚ˆã‚‹ã‚µã‚¸ã‚§ã‚¹ãƒˆã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã“ã¨ãŒã†ã‹ãŒãˆã¾ã™ã€‚

```
POST _analyze
{
 "text": ["é³¥å–çœŒ"],
 "analyzer": "kuromoji_completion"
}
```

```
{
  "tokens": [
    {
      "token": "é³¥å–",
      "start_offset": 0,
      "end_offset": 2,
      "type": "word",
      "position": 0
    },
    {
      "token": "tottori",
      "start_offset": 0,
      "end_offset": 2,
      "type": "word",
      "position": 0
    },
    {
      "token": "çœŒ",
      "start_offset": 2,
      "end_offset": 3,
      "type": "word",
      "position": 1
    },
    {
      "token": "ken",
      "start_offset": 2,
      "end_offset": 3,
      "type": "word",
      "position": 1
    },
    {
      "token": "kenn",
      "start_offset": 2,
      "end_offset": 3,
      "type": "word",
      "position": 1
    }
  ]
}
```

## æ³¨æ„äº‹é …

ç°¡å˜ã«ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆæ©Ÿèƒ½ãŒå®Ÿè£…ã§ãã¦æ¥½ã§ã™ãŒã€ãƒ­ãƒ¼ãƒå­—å¤‰æ›ã®ç²¾åº¦ã¯ Kuromoji è‡ªä½“ã®è¾æ›¸ã«ä¾å­˜ã—ã¾ã™ã€‚Kuromoji ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‚ç…§ã—ã¦ã„ã‚‹è¾æ›¸ã¯ 2007 å¹´ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒæ­¢ã¾ã£ã¦ãŠã‚Šã€æ–°ã—ã„å›ºæœ‰åè©ã‚’å‡¦ç†ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
ã“ã®ãŸã‚ã€"é¬¼æ»…ã®åˆƒ" ãªã©ã¯æ­£ã—ãã‚µã‚¸ã‚§ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

```
POST _analyze
{
 "text": ["é¬¼æ»…ã®åˆƒ"],
 "analyzer": "kuromoji_completion"
}
```

```
{
  "tokens": [
    {
      "token": "é¬¼",
      "start_offset": 0,
      "end_offset": 1,
      "type": "word",
      "position": 0
    },
    {
      "token": "oni",
      "start_offset": 0,
      "end_offset": 1,
      "type": "word",
      "position": 0
    },
    {
      "token": "æ»…",
      "start_offset": 1,
      "end_offset": 2,
      "type": "word",
      "position": 1
    },
    {
      "token": "metu",
      "start_offset": 1,
      "end_offset": 2,
      "type": "word",
      "position": 1
    },
    {
      "token": "metsu",
      "start_offset": 1,
      "end_offset": 2,
      "type": "word",
      "position": 1
    },
    {
      "token": "ã®",
      "start_offset": 2,
      "end_offset": 3,
      "type": "word",
      "position": 2
    },
    {
      "token": "no",
      "start_offset": 2,
      "end_offset": 3,
      "type": "word",
      "position": 2
    },
    {
      "token": "åˆƒ",
      "start_offset": 3,
      "end_offset": 4,
      "type": "word",
      "position": 3
    },
    {
      "token": "ha",
      "start_offset": 3,
      "end_offset": 4,
      "type": "word",
      "position": 3
    }
  ]
}
```

å¯¾ç­–ã¨ã—ã¦ã¯ã€Kuromoji ã®ã‚«ã‚¹ã‚¿ãƒ è¾æ›¸ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ã§ã™ã€‚
è¾æ›¸ã®æ–¹ã§é©åˆ‡ã«ã‚«ãƒŠã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€æ­£ã—ã„ã‚µã‚¸ã‚§ã‚¹ãƒˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```
POST _analyze
{
 "text": ["é¬¼æ»…ã®åˆƒ"],
  "tokenizer": {
      "type": "kuromoji_tokenizer",
      "mode": "extended",
      "user_dictionary_rules": [
        "é¬¼æ»…ã®åˆƒ,é¬¼æ»…ã®åˆƒ,ã‚­ãƒ¡ãƒ„ãƒãƒ¤ã‚¤ãƒ,ã‚«ã‚¹ã‚¿ãƒ åè©"
      ]
  },
  "filter": [
    {
      "type": "kuromoji_completion"
    }
  ]
}
```

```
{
  "tokens": [
    {
      "token": "é¬¼æ»…ã®åˆƒ",
      "start_offset": 0,
      "end_offset": 4,
      "type": "word",
      "position": 0
    },
    {
      "token": "kimetunoyaiba",
      "start_offset": 0,
      "end_offset": 4,
      "type": "word",
      "position": 0
    },
    {
      "token": "kimetsunoyaiba",
      "start_offset": 0,
      "end_offset": 4,
      "type": "word",
      "position": 0
    }
  ]
}
```
